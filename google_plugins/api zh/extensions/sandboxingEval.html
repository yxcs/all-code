<!DOCTYPE html>
<html>
  <head>
    <title>å®‰å…¨åœ°åœ¨ Chrome æ‰©å±•ç¨‹åºä¸­ä½¿ç”¨ eval - Google Chrome æ‰©å±•ç¨‹åºå¼€å‘æ–‡æ¡£ï¼ˆéå®˜æ–¹ä¸­æ–‡ç‰ˆï¼‰</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="../static/css/site.css" rel="stylesheet" type="text/css">
    <link href="../../developer.chrome.com/static/css/print.css" rel="stylesheet" type="text/css" media="print">
    <link href="../../developer.chrome.com/static/css/prettify.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  </head>

  <body>


<!-- Copyright © 2005. Spidersoft Ltd -->
<style>
A.applink:hover {border: 2px dotted #DCE6F4;padding:2px;background-color:#ffff00;color:green;text-decoration:none}
A.applink       {border: 2px dotted #DCE6F4;padding:2px;color:#2F5BFF;background:transparent;text-decoration:none}
A.info          {color:#2F5BFF;background:transparent;text-decoration:none}
A.info:hover    {color:green;background:transparent;text-decoration:underline}
</style>
<div style='BORDER: 1px solid #DCE6F4; MARGIN-TOP: 20px; MARGIN-BOTTOM: 20px; MARGIN-LEFT: 5px; MARGIN-RIGHT: 5px; PADDING: 5px; BACKGROUND-COLOR: #eef8ff;line-height:180%; COLOR: #000000; font-family: Arial; font-size: 8pt; width=100%; FILTER: progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr="#FFFFFFFF", EndColorStr="#F2F5FAFF");'>
This page was saved using <a class="applink" href="http://www.spidersoft.com"><b>WebZIP 7.0.3.1030</b></a> <a class="applink" href="http://www.spidersoft.com"><b>offline browser</b></a>  on  12/24/13 11:31:36.<br>
<b>Address:</b> <a class="info" href="https://crxdoc-zh.appspot.com/extensions/sandboxingEval.html">https://crxdoc-zh.appspot.com/extensions/sandboxingEval.html</a><br>
<b>Title:</b> å®‰å…¨åœ°åœ¨ Chrome æ‰©å±•ç¨‹åºä¸­ä½¿ç”¨ eval - Google Chrome æ‰©å±•ç¨‹åºå¼€å‘æ–‡æ¡£ï¼ˆéå®˜æ–¹ä¸­æ–‡ç‰ˆï¼‰ &nbsp;&bull;&nbsp; <b>Size:</b> 30345<br></div>
<!-- /Copyright © 2005. Spidersoft Ltd -->


    <div id="gc-topnav">
      <table><tr>
      <td id="chrome-logo">
        <a href="extensions.html" title="Google Chrome æ‰©å±•ç¨‹åº" id="view-original">
          <img src="../../developer.chrome.com/static/images/chrome-logo.png" alt=""> chrome
        </a>
        <script type="text/javascript">
          document.getElementById('view-original').href = "https://developer.chrome.com" + location.pathname;
        </script>
        <div id="platform-chooser">
          <button id="platform-chooser-toggle" data-menu="platform-chooser-popup">
            æ‰©å±•ç¨‹åº &#x25be;&#x202F;
          </button>
          <div id="platform-chooser-popup">
            <button class="apps" data-href="/apps/about_apps.html"><!--@apps-->åº”ç”¨</button>
            <button class="extensions" data-href="/extensions"><!--@extensions-->æ‰©å±•ç¨‹åº</button>
          </div>
        </div>ï¼ˆéå®˜æ–¹ä¸­æ–‡ç‰ˆï¼‰
      </td>
      <td>
        <ul>
          <li>
            <a href="samples.html"
               title="ç¤ºä¾‹ æ‰©å±•ç¨‹åºï¼ˆåŒ…å«æºä»£ç ï¼‰"><!--@Samples-->ç¤ºä¾‹</a>
          </li>
          <li>
            <a href="http://groups.google.com/a/chromium.org/group/chromium-extensions"
               title="Google Chrome æ‰©å±•ç¨‹åºå¼€å‘è€…è®ºå›"
               target="_blank"><!--@Group-->è®ºå›ï¼ˆè‹±æ–‡ï¼‰</a>
          </li>
          <li>
            <a href="http://stackoverflow.com/tags/google-chrome-extension/info"
               title="Stack Overflow ä¸Šçš„ [google-chrome-extension] æ ‡ç­¾"
               target="_blank">Stack overflow</a>
          </li>
        </ul>
      </td>
      </tr></table>
    </div>
    <div id="gc-topnav-space"></div>
    <div id="gc-container">
      <div id="gc-sidebar">
        <g:plusone></g:plusone>
        <ul 
            class="level1 ">
        <li class="level2">
              <a href="getstarted.html" class="level2 ">å…¥é—¨</a>
        </li><li class="level2">
              <a href="overview.html" class="level2 ">æ¦‚è¿°</a>
        </li><li class="level2">
              <a href="whats_new.html" class="level2 ">æ–°å¢åŠŸèƒ½</a>
        </li><li class="level2">
              <a href="devguide.html" class="level2 ">å¼€å‘è€…æŒ‡å—</a>
          <ul 
              class="level2 ">
          <li class="level3">
              <a class="button level3">
                <span class="level3">æµè§ˆå™¨ç”¨æˆ·ç•Œé¢</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable
                class="level3 hidden">
            <li class="level4">
                  <a href="browserAction.html" class="level4 ">æµè§ˆå™¨æŒ‰é’®</a>
            </li><li class="level4">
                  <a href="contextMenus.html" class="level4 ">å³é”®èœå•</a>
            </li><li class="level4">
                  <a href="desktop_notifications.html" class="level4 ">æ¡Œé¢é€šçŸ¥</a>
            </li><li class="level4">
                  <a href="omnibox.html" class="level4 ">å¤šåŠŸèƒ½æ¡†</a>
            </li><li class="level4">
                  <a href="options.html" class="level4 ">é€‰é¡¹é¡µé¢</a>
            </li><li class="level4">
                  <a href="override.html" class="level4 ">æ›¿ä»£é¡µé¢</a>
            </li><li class="level4">
                  <a href="pageAction.html" class="level4 ">é¡µé¢æŒ‰é’®</a>
            </li>
            </ul>
          </li><li class="level3">
              <a class="button level3">
                <span class="level3">æµè§ˆå™¨äº¤äº’</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable
                class="level3 hidden">
            <li class="level4">
                  <a href="bookmarks.html" class="level4 ">ä¹¦ç­¾</a>
            </li><li class="level4">
                  <a href="cookies.html" class="level4 ">Cookie</a>
            </li><li class="level4">
                  <a href="devtools.html" class="level4 ">æ‰©å±•å¼€å‘è€…å·¥å…·</a>
            </li><li class="level4">
                  <a href="events.html" class="level4 ">äº‹ä»¶</a>
            </li><li class="level4">
                  <a href="history.html" class="level4 ">å†å²è®°å½•</a>
            </li><li class="level4">
                  <a href="management.html" class="level4 ">ç®¡ç†</a>
            </li><li class="level4">
                  <a href="tabs.html" class="level4 ">æ ‡ç­¾é¡µ</a>
            </li><li class="level4">
                  <a href="windows.html" class="level4 ">çª—å£</a>
            </li>
            </ul>
          </li><li class="level3">
              <a class="button level3">
                <span class="level3">å®ç°</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable
                class="level3 hidden">
            <li class="level4">
                  <a href="a11y.html" class="level4 ">è¾…åŠ©åŠŸèƒ½</a>
            </li><li class="level4">
                  <a href="event_pages.html" class="level4 ">äº‹ä»¶é¡µé¢</a>
            </li><li class="level4">
                  <a href="contentSecurityPolicy.html" class="level4 ">å†…å®¹å®‰å…¨ç­–ç•¥</a>
            </li><li class="level4">
                  <a href="content_scripts.html" class="level4 ">å†…å®¹è„šæœ¬</a>
            </li><li class="level4">
                  <a href="xhr.html" class="level4 ">è·¨ç«™ XHR</a>
            </li><li class="level4">
                  <a href="i18n.html" class="level4 ">å›½é™…åŒ–æ”¯æŒ</a>
            </li><li class="level4">
                  <a href="messaging.html" class="level4 ">æ¶ˆæ¯ä¼ é€’</a>
            </li><li class="level4">
                  <a href="permissions.html" class="level4 ">å¯é€‰æƒé™</a>
            </li><li class="level4">
                  <a href="npapi.html" class="level4 ">NPAPI æ’ä»¶</a>
            </li>
            </ul>
          </li><li class="level3">
              <a class="button level3">
                <span class="level3">å®Œæˆ</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable
                class="level3 hidden">
            <li class="level4">
                  <a href="hosting.html" class="level4 ">æ‰˜ç®¡</a>
            </li><li class="level4">
                  <a href="external_extensions.html" class="level4 ">å…¶ä»–å‘å¸ƒé€‰é¡¹</a>
            </li>
            </ul>
          </li>
          </ul>
        </li><li class="level2">
              <a href="tutorials.html" class="level2 ">æ•™ç¨‹</a>
          <ul 
              class="level2 ">
          <li class="level3">
                <a href="tut_migration_to_manifest_v2.html" class="level3 ">æ¸…å•æ–‡ä»¶ç‰ˆæœ¬ 2</a>
          </li><li class="level3">
                <a href="tut_debugging.html" class="level3 ">è°ƒè¯•</a>
          </li><li class="level3">
                <a href="tut_analytics.html" class="level3 ">Google Analyticsï¼ˆåˆ†æï¼‰</a>
          </li><li class="level3">
                <a href="tut_oauth.html" class="level3 ">OAuth</a>
          </li>
          </ul>
        </li><li class="level2">
              <span class="level2">å‚è€ƒ</span>
          <ul 
              class="level2 ">
          <li class="level3">
              <a class="button level3">
                <span class="level3">æ ¼å¼</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable
                class="level3 hidden">
            <li class="level4">
                  <a href="manifest.html" class="level4 ">æ¸…å•æ–‡ä»¶</a>
            </li><li class="level4">
                  <a href="match_patterns.html" class="level4 ">åŒ¹é…è¡¨è¾¾å¼</a>
            </li>
            </ul>
          </li><li class="level3">
                <a href="permission_warnings.html" class="level3 ">æƒé™è­¦å‘Š</a>
          </li><li class="level3">
                <a href="api_index.html" class="level3 ">chrome.* API</a>
          </li><li class="level3">
                <a href="api_other.html" class="level3 ">å…¶ä»– API</a>
          </li>
          </ul>
        </li><li class="level2">
              <span class="level2">æ›´å¤š</span>
          <ul 
              class="level2 ">
          <li class="level3">
                <a href="faq.html" class="level3 ">å¸¸è§é—®é¢˜</a>
          </li><li class="level3">
                <a href="http://code.google.com/chrome/webstore/docs/index.html" class="level3 ">Chrome ç½‘ä¸Šåº”ç”¨åº—</a>
          </li><li class="level3">
                <a href="http://code.google.com/chrome/apps/docs/developers_guide.html" class="level3 ">æ‰˜ç®¡åº”ç”¨</a>
          </li><li class="level3">
                <a href="themes.html" class="level3 ">ä¸»é¢˜èƒŒæ™¯</a>
          </li>
          </ul>
        </li>
        </ul>
      </div>
      <div id="gc-pagecontent">

<div id="toc">
  <ol>
    <li >
      <a href="#why_sandbox"
         data-list-item
         >ä¸ºä»€ä¹ˆä½¿ç”¨æ²™ç®±ï¼Ÿ</a>
    </li>
    <li >
      <a href="#creating_and_using"
         data-list-item
         >åˆ›å»ºå’Œä½¿ç”¨æ²™ç®±</a>
      <ol>
        <li >
          <a href="#list_files"
             data-list-item
             >åœ¨æ¸…å•æ–‡ä»¶ä¸­åˆ—å‡ºæ–‡ä»¶</a>
        </li>
        <li >
          <a href="#load_file"
             data-list-item
             >åŠ è½½å—æ²™ç®±ä¿æŠ¤çš„æ–‡ä»¶</a>
        </li>
        <li >
          <a href="#do_something"
             data-list-item
             >åšä¸€äº›æœ‰æ½œåœ¨å±é™©çš„äº‹</a>
        </li>
        <li >
          <a href="#pass_result"
             data-list-item
             >å°†ç»“æœä¼ å›</a>
        </li>
      </ol>
    </li>
  </ol>
</div>

<h1><!--@Using eval in Chrome Extensions. Safely.-->å®‰å…¨åœ°åœ¨ Chrome æ‰©å±•ç¨‹åºä¸­ä½¿ç”¨ eval</h1>


<p>
  <!--@Chrome's extension system enforces a fairly strict default
  <a href='../extensions/contentSecurityPolicy.html'>
    <strong>Content Security Policy (CSP)</strong>
  </a>. The policy restrictions are straightforward: script must be moved
  out-of-line into separate JavaScript files, inline event handlers must be
  converted to use <code>addEventListener</code>, and <code>eval()</code> is
  disabled. Chrome Apps have an
  <a href='contentSecurityPolicy.html'>even more strict
  policy</a>, and we're quite happy with the security properties these policies
  provide.-->
  Chrome æµè§ˆå™¨çš„æ‰©å±•ç¨‹åºç³»ç»Ÿé»˜è®¤æƒ…å†µä¸‹å¼ºåˆ¶å®æ–½ç›¸å½“ä¸¥æ ¼çš„<a
  href='contentSecurityPolicy.html'><strong>å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰</strong></a>ã€‚è¿™äº›ç­–ç•¥é™åˆ¶éå¸¸ç›´ç™½ï¼šå†…åµŒè„šæœ¬å¿…é¡»ç§»åŠ¨è‡³å•ç‹¬çš„
  JavaScript æ–‡ä»¶ï¼Œå†…åµŒçš„äº‹ä»¶å¤„ç†å‡½æ•°å¿…é¡»è½¬æ¢ä¸ºä½¿ç”¨
  <code>addEventListener</code>ï¼Œå¹¶ä¸” <code>eval()</code> å·²ç¦ç”¨ã€‚Chrome
  æµè§ˆå™¨çš„åº”ç”¨å…·æœ‰æ›´ä¸¥æ ¼çš„ç­–ç•¥ï¼Œç„¶è€Œæˆ‘ä»¬å¯¹äºè¿™äº›ç­–ç•¥æä¾›çš„å®‰å…¨ç‰¹æ€§ç›¸å½“æ»¡æ„ã€‚
</p>

<p>
  <!--@We recognize, however, that a variety of libraries use <code>eval()</code> and
  <code>eval</code>-like constructs such as <code>new Function()</code> for
  performance optimization and ease of expression. Templating libraries are
  especially prone to this style of implementation. While some (like
  <a href='http://angularjs.org/'>Angular.js</a>) support CSP out of the box,
  many popular frameworks haven't yet updated to a mechanism that is compatible
  with extensions' <code>eval</code>-less world. Removing support for that
  functionality has therefore proven <a href='http://crbug.com/107538'>more
  problematic than expected</a> for developers.-->
  ç„¶è€Œæˆ‘ä»¬ä¹Ÿæ‰¿è®¤ï¼Œå‡ºäºæ€§èƒ½ä¼˜åŒ–ä»¥åŠæ›´ç®€æ´çš„è¡¨è¾¾ï¼Œè®¸å¤šåº“éƒ½ä½¿ç”¨
  <code>eval()</code> æˆ–è€…ç±»ä¼¼äº eval çš„æ„é€ ï¼Œä¾‹å¦‚
  <code>new Function()</code>ã€‚å°½ç®¡å…¶ä¸­æŸäº›ï¼ˆåƒ
  <a href='http://angularjs.org/'>Angular.js</a>ï¼‰å·²ç»å¯ä»¥ç›´æ¥æ”¯æŒ
  CSPï¼Œè®¸å¤šæµè¡Œçš„æ¡†æ¶è¿˜æ²¡èƒ½æ›´æ–°è‡³ä¸æ‰©å±•ç¨‹åºä¸­ç¦æ­¢ <code>eval</code>
  çš„ç¯å¢ƒå…¼å®¹çš„æœºåˆ¶ï¼Œäº‹å®è¯æ˜ç§»é™¤è¯¥åŠŸèƒ½çš„æ”¯æŒå¯¹å¼€å‘äººå‘˜æ¥è¯´äº§ç”Ÿçš„é—®é¢˜<a href='http://crbug.com/107538'>æ¯”é¢„æ–™ä¸­æ›´å¤š</a>ã€‚
</p>

<p>
  <!--@This document introduces sandboxing as a safe mechanism to include these
  libraries in your projects without compromising on security. For brevity,
  we'll be using the term <em>extensions</em> throughout, but the concept
  applies equally to applications.-->
  è¯¥æ–‡æ¡£å¼•å…¥äº†æ²™ç®±ï¼Œä½œä¸ºä¸€ç§å®‰å…¨çš„æœºåˆ¶ï¼Œæ¥å°†è¿™äº›åº“åŒ…å«åœ¨æ‚¨çš„é¡¹ç›®ä¸­ï¼ŒåŒæ—¶ä¸å¨èƒå®‰å…¨ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬é€šç¯‡ä½¿ç”¨<em>æ‰©å±•ç¨‹åº</em>è¿™ä¸€æœ¯è¯­ï¼Œä½†æ˜¯è¿™ä¸€æ¦‚å¿µåŒæ ·é€‚ç”¨äºåº”ç”¨ã€‚
</p>

<h2 id="why_sandbox"><!--@Why sandbox?-->ä¸ºä»€ä¹ˆä½¿ç”¨æ²™ç®±ï¼Ÿ</h2>

<p>
  <code>eval</code> <!--@is dangerous inside an extension because the code it
  executes has access to everything in the extension's high-permission
  environment. A slew of powerful <code>chrome.*</code> APIs are available that
  could severely impact a user's security and privacy; simple data exfiltration
  is the least of our worries. The solution on offer is a sandbox in which
  <code>eval</code> can execute code without access either to the extension's
  data or the extension's high-value APIs. No data, no APIs, no problem.-->
  åœ¨æ‰©å±•ç¨‹åºä¸­æ˜¯å±é™©çš„ï¼Œå› ä¸ºå®ƒæ‰§è¡Œçš„ä»£ç å¯ä»¥åœ¨æ‰©å±•ç¨‹åºé«˜æƒé™çš„ç¯å¢ƒä¸‹è®¿é—®æ‰€æœ‰å†…å®¹ï¼Œå¯¹å¯ç”¨çš„å¼ºå¤§
  <code>chrome.* API</code>
  çš„æ»¥ç”¨ä¼šä¸¥é‡åœ°å½±å“ç”¨æˆ·çš„å®‰å…¨ä¸éšç§ï¼Œè€Œä¸ä»…ä»…æ˜¯ç®€å•çš„æ•°æ®æ³„æ¼ã€‚æˆ‘ä»¬æä¾›çš„è§£å†³æ–¹æ¡ˆæ˜¯èƒ½å¤Ÿä½¿
  <code>eval</code> æ‰§è¡Œä»£ç ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®æ‰©å±•ç¨‹åºæ•°æ®æˆ–è€…æ‰©å±•ç¨‹åºå¼ºå¤§çš„
  APIã€‚æ²¡æœ‰æ•°æ®ï¼Œæ²¡æœ‰ APIï¼Œå°±ä¸ä¼šæœ‰é—®é¢˜ã€‚
</p>

<p>
  <!--@We accomplish this by listing specific HTML files inside the extension package
  as being sandboxed. Whenever a sandboxed page is loaded, it will be moved to a
  <a href='http://www.whatwg.org/specs/web-apps/current-work/multipage/origin-0.html#sandboxed-origin-browsing-context-flag'>unique origin</a>,
  and will be denied access to <code>chrome.*</code> APIs. If we load this
  sandboxed page into our extension via an <code>iframe</code>, we can pass it
  messages, let it act upon those messages in some way, and wait for it to pass
  us back a result. This simple messaging mechanism gives us everything we need
  to safely include <code>eval</code>-driven code in our extension's workflow.-->
  æˆ‘ä»¬é€šè¿‡è¿™æ ·çš„æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ï¼šåˆ—å‡ºæ‰©å±•ç¨‹åºåŒ…å†…éœ€è¦åœ¨æ²™ç®±ä¸­è¿è¡Œçš„ç‰¹å®š
  HTML
  æ–‡ä»¶ã€‚æ¯å½“æ²™ç®±ä¿æŠ¤çš„é¡µé¢åŠ è½½æ—¶ï¼Œå®ƒå°†ä¼šè¢«ç§»è‡³æŸä¸ª<a
  href='http://www.whatwg.org/specs/web-apps/current-work/multipage/origin-0.html#sandboxed-origin-browsing-context-flag'
  >å”¯ä¸€çš„æ¥æº</a>ï¼Œå¹¶ä¸”æ‹’ç»è®¿é—®
  <code>chrome.* API</code>ã€‚å¦‚æœæˆ‘ä»¬é€šè¿‡ <code>iframe</code>
  å°†è¿™ä¸€å—æ²™ç®±ä¿æŠ¤çš„é¡µé¢åŠ è½½åˆ°æ‰©å±•ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘å®ƒä¼ é€’æ¶ˆæ¯ï¼Œè®©å®ƒä»¥æŸç§æ–¹å¼åŸºäºè¿™äº›æ¶ˆæ¯è¿è¡Œï¼Œå¹¶ç­‰å¾…å®ƒä¼ å›ç»“æœã€‚è¿™ç§ç®€å•çš„æ¶ˆæ¯æœºåˆ¶ä½¿æˆ‘ä»¬èƒ½å¤Ÿå®‰å…¨åœ°åœ¨æ‰©å±•ç¨‹åºçš„å·¥ä½œæµç¨‹ä¸­åŒ…å«
  <code>eval</code> é©±åŠ¨çš„ä»£ç ã€‚
</p>

<h2 id="creating_and_using"><!--@Creating and using a sandbox.-->åˆ›å»ºå’Œä½¿ç”¨æ²™ç®±</h2>

<p>
  <!--@If you'd like to dive straight into code, please grab the
  <a href='https://crxdoc-zh.appspot.com/extensions/samples.html#sandboxed-frame'>sandboxing
  sample extension and take off</a>. It's a working example of a tiny messaging
  API built on top of the <a href='http://handlebarsjs.com/'>Handlebars</a>
  templating library, and it should give you everything you need to get going.
  For those of you who'd like a little more explanation, let's walk through that
  sample together here.-->
  å¦‚æœæ‚¨æƒ³ç›´æ¥æ·±å…¥ä»£ç ï¼Œè¯·å‚è€ƒ<a href='https://crxdoc-zh.appspot.com/extensions/samples.html#sandboxed-frame'
  >æ²™ç®±ç¤ºä¾‹æ‰©å±•ç¨‹åº</a>ã€‚è¿™ä¸€å¯ä»¥æ­£å¸¸å·¥ä½œçš„ä¾‹å­åŒ…å«åŸºäº
  <a href='http://handlebarsjs.com/'>Handlebars</a>
  æ¨¡æ¿åº“æ„å»ºçš„çŸ­å°ç²¾æ‚çš„æ¶ˆæ¯
  APIï¼Œå®ƒåº”è¯¥èƒ½å¤Ÿä½¿æ‚¨äº†è§£æ¥ä¸‹æ¥æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ã€‚å¦‚æœæ‚¨éœ€è¦æ›´å¤šçš„è§£é‡Šï¼Œè¯·è·Ÿæˆ‘ä»¬ä¸€èµ·åœ¨è¿™é‡Œè¿›è¡Œè¯¥ç¤ºä¾‹çš„æ¼”ç»ƒã€‚
</p>

<h3 id="list_files"><!--@List files in manifest-->åœ¨æ¸…å•æ–‡ä»¶ä¸­åˆ—å‡ºæ–‡ä»¶</h3>

<p>
  <!--@Each file that ought to be run inside a sandbox must be listed in the
  extension manifest by adding a <code>sandbox</code> property. This is a
  critical step, and it's easy to forget, so please double check that your
  sandboxed file is listed in the manifest. In this sample, we're sandboxing the
  file cleverly named "sandbox.html". The manifest entry looks like this:-->
  åº”è¯¥åœ¨æ²™ç®±ä¸­æ‰§è¡Œçš„æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½å¿…é¡»åœ¨æ‰©å±•ç¨‹åºçš„æ¸…å•æ–‡ä»¶ä¸­åˆ—å‡ºï¼Œæ·»åŠ 
  <code>sandbox</code> å±æ€§ã€‚è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“å¿˜è®°çš„ï¼Œæ‰€ä»¥è¯·å†æ¬¡æ£€æŸ¥æ‚¨éœ€è¦æ²™ç®±ä¿æŠ¤çš„æ–‡ä»¶ç¡®å®å·²åœ¨æ¸…å•æ–‡ä»¶ä¸­åˆ—å‡ºã€‚åœ¨è¯¥ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ²™ç®±ä¿æŠ¤çš„æ–‡ä»¶æ°å¥½å‘½åä¸ºâ€œsandbox.htmlâ€ã€‚æ¸…å•æ–‡ä»¶é¡¹å¦‚ä¸‹æ‰€ç¤ºï¼š
</p>

<pre data-filename="manifest.json">
{
  ...,
  "sandbox": {
     "pages": ["sandbox.html"]
  },
  ...
}
</pre>

<h3 id="load_file"><!--@Load the sandboxed file-->åŠ è½½å—æ²™ç®±ä¿æŠ¤çš„æ–‡ä»¶</h3>

<p>
  <!--@In order to do something interesting with the sandboxed file, we need to load
  it in a context where it can be addressed by the extension's code. Here,
  <a href='examples/howto/sandbox/sandbox.html'>sandbox.html</a>
  has been loaded into the extension's <a href='event_pages.html'>Event
  Page</a> (<a href='examples/howto/sandbox/eventpage.html'>eventpage.html</a>)
  via an <code>iframe</code>. <a href='examples/howto/sandbox/eventpage.js'>eventpage.js</a>
  contains code that sends a message into the sandbox whenever the browser
  action is clicked by finding the <code>iframe</code> on the page, and
  executing the <code>postMessage</code> method on its
  <code>contentWindow</code>. The message is an object containing two
  properties: <code>context</code> and <code>command</code>. We'll dive into
  both in a moment.-->
  ä¸ºäº†é€šè¿‡å—æ²™ç®±ä¿æŠ¤çš„æ–‡ä»¶åšä¸€äº›æœ‰æ„ä¹‰çš„äº‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ‰©å±•ç¨‹åºä»£ç å¯ä»¥è®¿é—®çš„ç¯å¢ƒä¸­åŠ è½½å®ƒã€‚åœ¨è¯¥ç¤ºä¾‹ä¸­ï¼Œ<a href='examples/howto/sandbox/sandbox.html'>sandbox.html</a>
  é€šè¿‡ <code>iframe</code> åœ¨æ‰©å±•ç¨‹åºçš„<a href="event_pages.html"
  >äº‹ä»¶é¡µé¢</a>ï¼ˆ<a href='examples/howto/sandbox/eventpage.html'
  >eventpage.html</a>ï¼‰ä¸­åŠ è½½ã€‚æ¯å½“æµè§ˆå™¨æŒ‰é’®å•å‡»æ—¶ï¼Œ<a href='examples/howto/sandbox/eventpage.js'>eventpage.js</a>
  ä¸­åŒ…å«çš„ä»£ç ä¼šæ‰¾åˆ°é¡µé¢ä¸­çš„ <code>iframe</code>ï¼Œå¹¶åœ¨å®ƒçš„
  <code>contentWindow</code> ä¸Šæ‰§è¡Œ <code>postMessage</code>
  æ–¹æ³•ï¼Œå‘æ²™ç®±å‘é€æ¶ˆæ¯ã€‚è¯¥æ¶ˆæ¯ä¸ºåŒ…å«ä¸¤ä¸ªå±æ€§çš„å¯¹è±¡ï¼š<code>context</code>
  å’Œ <code>command</code>ï¼Œæˆ‘ä»¬ç¨åä¼šè¯¦ç»†è§£é‡Šå®ƒä»¬ã€‚
</p>

<pre data-filename="eventpage.js">
chrome.browserAction.onClicked.addListener(function() {
 var iframe = document.getElementById('theFrame');
 var message = {
   command: 'render',
   context: {thing: 'world'}
 };
 iframe.contentWindow.postMessage(message, '*');
});
</pre>

<p class="note">
  <!--@For general information about the <code>postMessage</code> API, take a look at
  the <a href="https://developer.mozilla.org/en/DOM/window.postMessage">
    <code>postMessage</code> documentation on MDN
  </a>. It's quite complete and worth reading. In particular, note that data can
  only be passed back and forth if it's serializable. Functions, for instance,
  are not.-->
  æœ‰å…³ <code>postMessage</code> API çš„ä¸€èˆ¬ä¿¡æ¯ï¼Œè¯·å‚è€ƒ
  <a href="https://developer.mozilla.org/en/DOM/window.postMessage">MDN
  ä¸Šçš„ <code>postMessage</code>
  æ–‡æ¡£</a>ï¼ˆè‹±æ–‡ï¼‰ï¼Œå®ƒéå¸¸å®Œæ•´ï¼Œå€¼å¾—ä¸€è¯»ã€‚ç‰¹åˆ«æ³¨æ„åªæœ‰å¯ä»¥åºåˆ—åŒ–çš„æ•°æ®æ‰èƒ½æ¥å›ä¼ é€’ï¼Œä¾‹å¦‚å‡½æ•°å°±ä¸è¡Œã€‚
</p>

<h3 id="do_something"><!--@Do something dangerous-->åšä¸€äº›æœ‰æ½œåœ¨å±é™©çš„äº‹</h3>

<p>
  <!--@When <code>sandbox.html</code> is loaded, it loads the Handlebars library, and
  creates and compiles an inline template in the way Handlebars suggests:-->
  å½“ <code>sandbox.html</code> åŠ è½½æ—¶ï¼Œå®ƒä¼šåŠ è½½ Handlebars åº“ï¼Œå¹¶ä»¥
  Handlebars æä¾›çš„æ–¹å¼åˆ›å»ºå¹¶ç¼–è¯‘å†…åµŒæ¨¡æ¿ï¼š
</p>

<pre data-filename="sandbox.html">
&lt;script src="handlebars-1.0.0.beta.6.js"&gt;&lt;/script&gt;
&lt;script id="hello-world-template" type="text/x-handlebars-template"&gt;
  &lt;div class="entry"&gt;
    &lt;h1&gt;Hello, &#123&#123thing&#125&#125!&lt;/h1&gt;
  &lt;/div&gt;
&lt;/script&gt;
&lt;script&gt;
  var templates = [];
  var source = document.getElementById('hello-world-template').innerHTML;
  templates['hello'] = Handlebars.compile(source);
&lt;/script&gt;
</pre>

<p>
  <!--@This doesn't fail! Even though <code>Handlebars.compile</code> ends up using
  <code>new Function</code>, things work exactly as expected, and we end up with
  a compiled template in <code>templates[â€˜hello']</code>.-->
  ä»¥ä¸Šä»£ç ä¸ä¼šå¤±è´¥ï¼å°½ç®¡ <code>Handlebars.compile</code> æœ€ç»ˆä¼šä½¿ç”¨
  <code>new Function</code>ï¼Œä¸€åˆ‡éƒ½å®Œå…¨ä¸é¢„æœŸä¸­ä¸€æ ·ï¼Œæœ€ç»ˆ
  <code>templates['hello']</code> ä¸­åŒ…å«äº†å·²ç¼–è¯‘çš„æ¨¡æ¿ã€‚
</p>

<h3 id="pass_result"><!--@Pass the result back-->å°†ç»“æœä¼ å›</h3>

<p>
  <!--@We'll make this template available for use by setting up a message listener
  that accepts commands from the Event Page. We'll use the <code>command</code>
  passed in to determine what ought to be done (you could imagine doing more
  than simply rendering; perhaps creating templates? Perhaps managing them in
  some way?), and the <code>context</code> will be passed into the template
  directly for rendering. The rendered HTML will be passed back to the Event
  Page so the extension can do something useful with it later on:-->
  æˆ‘ä»¬å°†è®¾ç½®æ¶ˆæ¯ç›‘å¬å™¨ï¼Œä»äº‹ä»¶é¡µé¢æ¥æ”¶å‘½ä»¤ï¼Œä½¿å¾—è¯¥æ¨¡æ¿å¯ä»¥ä½¿ç”¨ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¼ å…¥çš„
  <code>command</code>
  æ¥ç¡®å®šåšä»€ä¹ˆï¼ˆæ‚¨å¯ä»¥æƒ³è±¡ï¼Œèƒ½åšçš„ä¸ä»…ä»…æ˜¯ç®€å•çš„æ¸²æŸ“ï¼Œä¹Ÿè®¸åˆ›å»ºæ¨¡æ¿ï¼Ÿä¹Ÿè®¸ç”¨æŸç§æ–¹å¼ç®¡ç†å®ƒä»¬ï¼Ÿï¼‰ï¼Œè€Œ
  <code>context</code>
  å°†ç›´æ¥ä¼ å…¥æ¨¡æ¿ï¼Œç”¨äºæ¸²æŸ“ã€‚æ¸²æŸ“å¾—åˆ°çš„ HTML
  å°†ä¼ å›äº‹ä»¶é¡µé¢ï¼Œä»¥ä¾¿æ‰©å±•ç¨‹åºåˆ©ç”¨å®ƒæ¥ç€åšä¸€äº›æœ‰ç”¨çš„äº‹ï¼š
</p>

<pre data-filename="sandbox.html">
&lt;script&gt;
  window.addEventListener('message', function(event) {
    var command = event.data.command;
    var name = event.data.name || 'hello';
    switch(command) {
      case 'render':
        event.source.postMessage({
          name: name,
          html: templates[name](event.data.context)
        }, event.origin);
        break;
  
      // case 'somethingElse':
      //   ...
    }
  });
&lt;/script&gt;
</pre>

<p>
  <!--@Back in the Event Page, we'll receive this message, and do something
  interesting with the <code>html</code> data we've been passed. In this case,
  we'll just echo it out via a <a href='desktop_notifications.html'>Desktop
  Notification</a>, but it's entirely possible to use this HTML safely as part
  of the extension's UI. Inserting it via <code>innerHTML</code> doesn't pose a
  significant security risk, as even a complete compromise of the sandboxed code
  through some clever attack would be unable to inject dangerous script or
  plugin content into the high-permission extension context.-->
  å›åˆ°äº‹ä»¶é¡µé¢ï¼Œæˆ‘ä»¬ä¼šæ¥æ”¶åˆ°è¯¥æ¶ˆæ¯ï¼Œå¹¶åˆ©ç”¨ä¼ é€’ç»™æˆ‘ä»¬çš„ <code>html</code>
  æ•°æ®åšä¸€äº›æœ‰æ„ä¹‰çš„äº‹ã€‚åœ¨è¿™ä¸€ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯é€šè¿‡<a
  href="desktop_notifications.html">æ¡Œé¢é€šçŸ¥</a>æ˜¾ç¤ºå®ƒï¼Œä½†æ˜¯å®Œå…¨å¯èƒ½å®‰å…¨åœ°ä½¿ç”¨è¿™ä¸€
  HTML ä½œä¸ºæ‰©å±•ç¨‹åºç”¨æˆ·ç•Œé¢çš„ä¸€éƒ¨åˆ†ã€‚é€šè¿‡ <code>innerHTML</code>
  å°†å…¶æ’å…¥å¹¶æ²¡æœ‰ä¸¥é‡çš„å®‰å…¨é£é™©ï¼Œå³ä½¿æ˜¯é€šè¿‡æŸäº›å·§å¦™çš„æ”»å‡»å®Œå…¨åˆ©ç”¨æ²™ç®±ä¸­çš„ä»£ç ï¼Œä¹Ÿä¸å¯èƒ½å‘é«˜æƒé™çš„æ‰©å±•ç¨‹åºç¯å¢ƒæ’å…¥å±é™©çš„è„šæœ¬æˆ–æ’ä»¶å†…å®¹ã€‚
</p>

<p>
  <!--@This mechanism makes templating straightforward, but it of course isn't
  limited to templating. Any code that doesn't work out of the box under a
  strict Content Security Policy can be sandboxed; in fact, it's often useful
  to sandbox components of your extensions that <em>would</em> run correctly in
  order to restrict each piece of your program to the smallest set of privileges
  necessary for it to properly execute. The
  <a href="http://www.youtube.com/watch?v=GBxv8SaX0gg">Writing Secure Web Apps
  and Chrome Extensions</a> presentation from Google I/O 2012 gives some good
  examples of these technique in action, and is worth 56 minutes of your time.-->
  è¿™ä¸€æœºåˆ¶å¾ˆç›´ç™½åœ°æè¿°äº†æ¨¡æ¿çš„ä½¿ç”¨ï¼Œç„¶è€Œå®ƒå½“ç„¶ä¸ä»…ä»…é™äºä½¿ç”¨æ¨¡æ¿ï¼Œæ‰€æœ‰ä¸èƒ½åœ¨ä¸¥æ ¼çš„å†…å®¹å®‰å…¨ç­–ç•¥ä¸‹ç›´æ¥è¿è¡Œçš„ä»£ç éƒ½å¯ä»¥åœ¨æ²™ç®±ä¸­è¿è¡Œã€‚äº‹å®ä¸Šï¼Œå°†æ‚¨çš„æ‰©å±•ç¨‹åºä¸­<em>èƒ½å¤Ÿ</em>æ­£ç¡®è¿è¡Œçš„å„ç»„ä»¶é™åˆ¶åœ¨æ²™ç®±ä¸­ï¼Œå¯ä»¥ä½¿æ‚¨çš„ç¨‹åºçš„æ¯ä¸€éƒ¨åˆ†éƒ½é™åˆ¶åœ¨æ­£å¸¸æ‰§è¡Œæ‰€éœ€çš„æœ€å°æƒé™ä¸‹ã€‚æ¥è‡ª
  Google I/O 2012 çš„æ¼”ç¤ºæ–‡ç¨¿<a href="https://www.youtube.com/watch?v=GBxv8SaX0gg">ç¼–å†™å®‰å…¨çš„ç½‘ç»œåº”ç”¨å’Œ Chrome æ‰©å±•ç¨‹åº</a>ï¼ˆè‹±æ–‡ï¼‰æä¾›äº†åˆ©ç”¨è¿™äº›æŠ€æœ¯çš„ä¾‹å­ï¼Œå€¼å¾—èŠ±è´¹æ‚¨ 56 åˆ†é’Ÿçš„æ—¶é—´ã€‚
</p>
      </div>
    </div>
  </body>

  <div id="gc-footer">
    <button class="google-button" id="scroll-to-top">â†‘</button>
    <button class="google-button" id="send-feedback" style="display:none">Send Feedback</button>
    <div class="text">
      <p>
        <!--@Except as otherwise <a href="http://code.google.com/policies.html#restrictions">noted</a>,
        the content of this page is licensed under the <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons
        Attribution 3.0 License</a>, and code samples are licensed under the
        <a rel="license" href="http://code.google.com/google_bsd_license.html">BSD License</a>.-->
        è¯¥é¡µé¢ç¿»è¯‘è‡ª
        <a href="https://developer.chrome.com/extensions/">Google Chrome Extensions</a>
        ä¸
        <a href="https://developer.chrome.com/apps/">Google Chrome Apps</a>ã€‚é™¤éç‰¹åˆ«<a href="https://code.google.com/policies.html#restrictions">è¯´æ˜</a>ï¼Œè¯¥é¡µé¢çš„å†…å®¹éµå¾ª
        <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0
        License</a>ï¼Œä»£ç ç¤ºä¾‹éµå¾ª
        <a rel="license" href="http://code.google.com/google_bsd_license.html">BSD License</a>ã€‚
      </p>
      <p class="crxdoczh-footer">
        <a href="https://code.google.com/p/crxdoczh/">crxdoczh é¡¹ç›®ä¸»é¡µ</a>
        <a href="https://code.google.com/p/crxdoczh/issues/entry?template=%E7%BD%91%E7%AB%99%E5%8F%8D%E9%A6%88">å‘é€åé¦ˆ</a>
        <a href="" rel="publisher">
          Google+ é¡µé¢
        </a>
        <a href="https://plus.google.com/communities/105384952265487436177">Google+ ç¤¾ç¾¤</a>
      </p>
      <script src="../../developer.chrome.com/static/js/platform_chooser.js" type="text/javascript"></script>
      <script src="../../developer.chrome.com/static/js/popup.js" type="text/javascript"></script>
      <script src="../../developer.chrome.com/static/js/prettify.js" type="text/javascript"></script>
      <script src="../../developer.chrome.com/static/js/scroll.js" type="text/javascript"></script>
      <script src="../../developer.chrome.com/static/js/sidebar.js" type="text/javascript"></script>
      <script src="../../developer.chrome.com/static/js/tabs.js" type="text/javascript"></script>
      <script>
        (function() {
          // Auto syntax highlight all pre tags.
          var preElements = document.getElementsByTagName('pre');
          for (var i = 0; i < preElements.length; i++) {
            var preElement = preElements[i];
            preElement.classList.add('prettyprint');
            var datasetFilename = preElement.getAttribute('data-filename');
            if (datasetFilename) {
              var filename = document.createElement('div');
              filename.className = 'filename nocode';
              filename.textContent = datasetFilename;
              preElement.insertBefore(filename, preElement.firstChild);
            }
          }
          prettyPrint();
        })();

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-25062424-1']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = 'https://ssl.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

        window.___gcfg = {
      Â  Â  lang: 'zh-CN'
      Â  };
      Â  (function() {
      Â  Â  var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      Â  Â  po.src = 'https://apis.google.com/js/plusone.js';
      Â  Â  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      Â  })();
      </script>
    </div>
  </div>
</html>
